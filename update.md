# 更新日志

## 2024-05-31

### 修复<think>标签处理
- 优化消息处理流程，过滤掉<think>标签内的思考内容
- 在用户输入和历史消息处理中都添加了思考内容过滤
- 确保思考内容不会被发送到联网搜索或AI模型处理
- 保留原始消息显示格式，仅在处理时进行过滤

### 网络搜索关键词提取优化
- 改进搜索关键词提取，过滤掉用户思考内容
- 增强提示词指令，确保只提取客观事实部分
- 添加额外的正则过滤，移除"我在思考"等前缀
- 修复类型兼容性问题，确保配置正确加载

### 网络搜索功能升级
- 新增智能网络搜索功能，自动判断是否需要联网查询
- 优化搜索体验，使用直接网页抓取获取实时内容
- 支持多搜索引擎（Bing、Google）爬取，无需API密钥
- 完善搜索结果处理和展示，增强大模型回答准确性

### 技术实现
- 创建WebService服务，提供网络搜索、判断搜索需求、提取关键词等功能
- 使用原生fetch实现网络请求，无需额外依赖
- 集成搜索结果到大模型系统消息，保持对话上下文完整
- 优化搜索类型设置界面，移除不必要的配置选项

### 用户体验
- 启用网络搜索后，系统会在需要时自动搜索相关信息
- 搜索过程透明展示，用户可看到关键词提取和搜索状态
- 搜索结果直接整合到AI回复中，提供信息来源和链接

## 2023-11-21

### 功能优化
- 在消息发送后到接口响应前，添加加载中提示，提升用户体验
- 加载中提示直观展示AI思考状态，避免用户等待时无反馈的问题
- 优化加载状态控制逻辑，确保状态正确转换

### 技术细节
- 在ChatPanel组件中添加LoadingMessage组件用于显示加载状态
- 使用Spin组件实现加载动画效果
- 引入isLoading状态控制加载提示的显示和隐藏
- 在消息发送开始时设置加载状态，在收到第一个响应或发生错误时关闭加载状态

## 2024-06-01
### 优化：网络搜索参数配置化

- 将WebService中硬编码的搜索URL和User Agent改为可配置参数
- 在WebSearchConfig组件中添加高级设置功能，允许自定义搜索URL和User Agent
- 更新settingsStore，支持存储和读取新增的配置参数
- 优化ChatPanel组件，从配置中获取并传递搜索参数
- 这一改进增强了程序的灵活性，便于用户适应不同的网络环境

### 修复：网络搜索查询<think>标签过滤问题
- 修复WebService.ts中search方法未正确过滤<think>标签内容的问题
- 在search方法开始处添加removeThinkTags过滤步骤
- 确保思考内容不会被包含在搜索查询中
- 提高搜索结果的准确性和相关性

### 优化：搜索URL构建逻辑
- 将搜索URL构建逻辑抽取到独立的getSearchUrl方法中
- 提高代码可维护性和复用性
- 使URL构建逻辑更清晰，便于后续扩展
- 符合单一职责原则，便于测试和维护

### 重构：WebService模块化架构
- 创建WebService文件夹，采用模块化架构设计
- 设计搜索服务抽象基类AbstractSearchService，定义通用接口
- 实现各搜索引擎具体实现类：BingSearchService, GoogleSearchService, BaiduSearchService
- 添加SearchFactory工厂类，实现对象创建和缓存管理
- 重构主WebService类，使用工厂模式创建对应的搜索服务
- 新增百度搜索支持，扩展WebSearchType类型和WebSearchConfig组件
- 删除原WebService.ts文件，完成模块化迁移
- 优化WebSearchConfig组件，使用枚举动态生成搜索引擎选项
- 更新持久化逻辑，确保baidu类型搜索引擎配置正确保存与读取
- 改进搜索引擎HTML解析逻辑，增加调试输出，提高搜索结果准确性
- 大幅提高代码复用性、可扩展性和可维护性

### 优化：解决网络搜索结果未被有效利用的问题
- 增强了搜索服务的调试功能，添加详细日志输出帮助追踪问题
- 优化了Bing、Google和百度三个搜索引擎的HTML解析逻辑
- 改进了正则表达式匹配规则，提高了搜索结果的准确性
- 调整了搜索结果格式化方法，强化了提示词的引导性
- 让模型更倾向于优先使用搜索结果中的最新信息回答问题
- 增加了OllamaService的调试日志，帮助追踪API通讯问题

### 修复：调整网络搜索结果展示方式
- 将搜索结果从系统消息改为嵌入用户消息中，解决大模型忽略搜索结果的问题
- 通过在用户原始消息后附加搜索结果，使模型更容易关注和使用这些最新信息
- 优化了搜索结果提示语，使其更加强调使用搜索结果内容
- 增加了OllamaService的日志记录，便于调试消息传递流程
- 改进了搜索结果处理逻辑，防止特殊情况下的消息丢失

#### 新增：会话操作功能增强
- 新增清空对话功能：在会话顶部添加清空消息按钮，支持一键清空当前会话所有消息
- 实现二次确认机制：点击清空按钮后弹出确认对话框，防止误操作
- 增强了会话状态管理：在chatStore中添加clearMessages方法，支持完全清空指定会话的消息
- 优化了按钮状态控制：当没有消息或正在生成回复时，清空按钮会自动禁用

#### 新增：会话列表管理功能
- 新增会话删除功能：在会话列表项上添加删除图标，支持一键删除不需要的会话
- 实现智能交互：鼠标悬停在会话项时才显示删除图标，保持界面整洁
- 添加二次确认机制：点击删除图标后弹出确认对话框，防止误操作
- 增强了会话状态管理：在chatStore中添加deleteSession方法，支持删除指定会话
- 设置了智能导航：删除当前会话时，自动导航到其他可用会话
- 保护默认会话：默认会话不允许删除，确保系统始终有一个基础会话可用 